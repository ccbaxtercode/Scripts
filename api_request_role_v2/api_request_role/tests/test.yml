---
# Test Playbook - api_request role'Ã¼nÃ¼ test etmek iÃ§in
# KullanÄ±m: ansible-playbook tests/test.yml --ask-vault-pass

- name: API Request Role Test Suite
  hosts: localhost
  gather_facts: no
  
  vars:
    # Test iÃ§in mock API (httpbin.org kullanarak)
    test_api_base: "https://httpbin.org"
  
  tasks:
    - name: "TEST 1: GET isteÄŸi (Basic Auth)"
      include_role:
        name: api_request
      vars:
        api_url: "{{ test_api_base }}/get"
        api_method: "GET"
        api_auth_type: "basic"
        api_username: "testuser"
        api_password: "testpass"
        api_headers:
          Accept: "application/json"
        api_verify_ssl: true
        api_no_log: false
    
    - name: "TEST 1 SonuÃ§"
      debug:
        msg: "âœ… GET Test baÅŸarÄ±lÄ± - Status: {{ api_response.status_code }}"
    
    - name: "TEST 2: POST isteÄŸi (JSON body)"
      include_role:
        name: api_request
      vars:
        api_url: "{{ test_api_base }}/post"
        api_method: "POST"
        api_auth_type: "basic"
        api_username: "testuser"
        api_password: "testpass"
        api_data:
          test_key: "test_value"
          number: 123
        api_no_log: false
    
    - name: "TEST 2 SonuÃ§"
      debug:
        msg: "âœ… POST Test baÅŸarÄ±lÄ± - Body: {{ api_response.body.json }}"
    
    - name: "TEST 3: PUT isteÄŸi"
      include_role:
        name: api_request
      vars:
        api_url: "{{ test_api_base }}/put"
        api_method: "PUT"
        api_auth_type: "basic"
        api_username: "testuser"
        api_password: "testpass"
        api_data:
          updated: true
        api_no_log: false
    
    - name: "TEST 3 SonuÃ§"
      debug:
        msg: "âœ… PUT Test baÅŸarÄ±lÄ± - Status: {{ api_response.status_code }}"
    
    - name: "TEST 4: DELETE isteÄŸi"
      include_role:
        name: api_request
      vars:
        api_url: "{{ test_api_base }}/delete"
        api_method: "DELETE"
        api_auth_type: "basic"
        api_username: "testuser"
        api_password: "testpass"
        api_no_log: false
    
    - name: "TEST 4 SonuÃ§"
      debug:
        msg: "âœ… DELETE Test baÅŸarÄ±lÄ± - Status: {{ api_response.status_code }}"
    
    - name: "TEST 5: Custom headers"
      include_role:
        name: api_request
      vars:
        api_url: "{{ test_api_base }}/headers"
        api_method: "GET"
        api_auth_type: "basic"
        api_username: "testuser"
        api_password: "testpass"
        api_headers:
          X-Custom-Header: "MyValue"
          X-Test-Id: "12345"
        api_no_log: false
    
    - name: "TEST 5 SonuÃ§"
      debug:
        msg: "âœ… Custom Headers Test baÅŸarÄ±lÄ±"
    
    - name: "TEST 6: Timeout kontrolÃ¼"
      include_role:
        name: api_request
      vars:
        api_url: "{{ test_api_base }}/delay/2"
        api_method: "GET"
        api_auth_type: "basic"
        api_username: "testuser"
        api_password: "testpass"
        api_timeout_connection: 5
        api_timeout_read: 10
        api_no_log: false
    
    - name: "TEST 6 SonuÃ§"
      debug:
        msg: "âœ… Timeout Test baÅŸarÄ±lÄ± - Elapsed: {{ api_response.elapsed_seconds }}s"
    
    - name: "TEST 7: Status 404 kontrolÃ¼ (fail_on_error=false)"
      include_role:
        name: api_request
      vars:
        api_url: "{{ test_api_base }}/status/404"
        api_method: "GET"
        api_auth_type: "basic"
        api_username: "testuser"
        api_password: "testpass"
        api_fail_on_error: false
        api_no_log: false
    
    - name: "TEST 7 SonuÃ§"
      debug:
        msg: "âœ… 404 Test baÅŸarÄ±lÄ± (hata gÃ¶rmezden gelindi) - Status: {{ api_response.status_code }}"
    
    - name: "ğŸ‰ TÃœM TESTLER BAÅARILI!"
      debug:
        msg: |
          âœ… Test Suite tamamlandÄ±!
          - GET isteÄŸi âœ“
          - POST isteÄŸi âœ“
          - PUT isteÄŸi âœ“
          - DELETE isteÄŸi âœ“
          - Custom headers âœ“
          - Timeout kontrolÃ¼ âœ“
          - Error handling âœ“
