# Dosya: state_save_vars.yml
# AÃ§Ä±klama: AdÄ±m baÅŸÄ±nda tÃ¼m deÄŸiÅŸkenleri state'e kaydet

---
- name: "[STATE] DeÄŸiÅŸkenler Kaydediliyor - {{ step_name }}"
  ansible.builtin.set_fact:
    vm_state: "{{ vm_state | combine({
        'vars': vm_state.vars | default({}) | combine({
          step_name: save_vars
        })
      }, recursive=True) }}"

- name: "[STATE] State DosyasÄ±nÄ± GÃ¼ncelle (Vars)"
  ansible.builtin.copy:
    content: "{{ vm_state | to_nice_json }}"
    dest: "{{ vm_state_file }}"

- name: "[STATE] DeÄŸiÅŸkenler Kaydedildi"
  ansible.builtin.debug:
    msg: "ğŸ“ {{ step_name }} iÃ§in {{ save_vars.keys() | list | length }} deÄŸiÅŸken kaydedildi"
